<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>TikTok Callback</title>
</head>
<body>
  <h2>Connexion TikTok en cours...</h2>
  <pre id="result">Chargement...</pre>

  <script>
    // ğŸ” RÃ©cupÃ¨re les paramÃ¨tres de l'URL (ex: ?code=xxxxx)
    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");
    const error = params.get("error");

    if (error) {
      document.getElementById("result").textContent = "âŒ Erreur TikTok : " + error;
    } else if (!code) {
      document.getElementById("result").textContent = "âš ï¸ Aucun code reÃ§u dans lâ€™URL.";
    } else {
      document.getElementById("result").textContent =
        "Code d'autorisation reÃ§u : " + code + "\n\nâ³ Envoi au serveur...";

      // ğŸ”¹ Envoi du code Ã  ton backend Vercel
      fetch("https://tiktok-bot-api.vercel.app/api/exchange", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ code })
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById("result").textContent =
          "âœ… RÃ©ponse du serveur TikTok :\n\n" + JSON.stringify(data, null, 2);

        // ğŸ’¡ Optionnel : affiche access_token / open_id si prÃ©sents
        if (data.access_token) {
          document.getElementById("result").textContent +=
            "\n\nğŸ”‘ Access Token : " + data.access_token +
            "\nğŸ‘¤ Open ID : " + data.open_id;
        }
      })
      .catch(err => {
        document.getElementById("result").textContent =
          "âŒ Erreur lors de la requÃªte : " + err.message;
      });
    }
  </script>
</body>
</html>
